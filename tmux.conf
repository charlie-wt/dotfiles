# === General ==========================================================================
# set terminal to be 256 colour (for vim in particular)
# set -g default-terminal "xterm-256color"
set -g default-terminal "xterm-kitty"
# set -ga terminal-overrides ",xterm-256color:Tc"
set -as terminal-overrides ",xterm-256color*:Ss@:Se@:Tc"
# Enable mouse control (clickable windows, panes, resizable panes)
set -g mouse on
# lower esc time -- introduces annoying lag when pressing esc in vim
set -sg escape-time 0
# increase scrollback limit
set -g history-limit 100000
# update frequency
set -g status-interval 1
# start windows and panes at 1, not 0
set -g base-index 1
setw -g pane-base-index 1
# renumber windows, to keep things 1 -> 2 -> 3 ...
set -g renumber-windows on
# vi mode
setw -g mode-keys vi
# needed for osc52 to work
set -s set-clipboard on


# === Rebindings =======================================================================
# prefix character
unbind C-b
set -g prefix 'C-\'
bind 'C-\' send-prefix
# panes - alternate mappings, & open in current pane's directory.
bind | split-window -h -c '#{pane_current_path}'
unbind %
bind - split-window -v -c '#{pane_current_path}'
unbind '"'
# windows - open in current window's directory.
bind c new-window -c '#{pane_current_path}'
# move window order
# (in ver. 3.0, the -d option swapped its behaviour)
if-shell '[[ $(tmux -V) =~ ^tmux\ [012]\. ]]' \
    'bind H swap-window    -t -1' \
    'bind H swap-window -d -t -1'
if-shell '[[ $(tmux -V) =~ ^tmux\ [012]\. ]]' \
    'bind L swap-window    -t +1' \
    'bind L swap-window -d -t +1'
# switch windows with alt-hl
bind -n M-h previous-window
bind -n M-l next-window
# slightly faster tab selection like in gtk apps
bind -n M-1 select-window -t 1
bind -n M-2 select-window -t 2
bind -n M-3 select-window -t 3
bind -n M-4 select-window -t 4
bind -n M-5 select-window -t 5
bind -n M-6 select-window -t 6
bind -n M-7 select-window -t 7
bind -n M-8 select-window -t 8
bind -n M-9 select-window -t 9

# match my vim keybinds for copy mode
bind -T copy-mode-vi H send-keys -X start-of-line
bind -T copy-mode-vi L send-keys -X end-of-line
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection
# normally you have to start a selection first to enter block mode; with this, you don't
bind -T copy-mode-vi C-v send-keys -X rectangle-toggle \; send -X begin-selection
# if you drag with the mouse to highlight something, don't copy it on release -- leave
# you in visual mode
unbind -T copy-mode-vi MouseDragEnd1Pane


# === New Commands =====================================================================
# Use r to quickly reload tmux settings
# TODO #bug: doesn't respond properly to $XDG_CONFIG_HOME
unbind r
bind r source-file ~/.config/tmux/tmux.conf \; display 'config reloaded.'


# === Colours ==========================================================================
# most stuff
set -g status-style fg=white,bg=black,default

# selected window
set-window-option -g window-status-current-style bg=black
set-window-option -g window-status-current-style fg=brightgreen,bold

# messages
set -g message-style fg=yellow,bg=black,default


# === Info =============================================================================
# left
set -g status-left " "
set -g status-justify left

setw -g window-status-format         ' #(echo "#{pane_current_command}") '
setw -g window-status-current-format ' #(echo "#{pane_current_command}") '

# right
set -g status-right "#{battery_percentage}   #[fg=colour12]%R  "


# === Plugins ==========================================================================
# plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'tmux-plugins/tmux-battery'

# init tpm
# note: for new machines, you also need to do prefix + I to install the plugins.
run '~/.config/tmux/plugins/tpm/tpm'